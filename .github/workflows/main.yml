# This is a basic workflow to help you get started with Actions

name: CI

# Controls when the action will run. Triggers the workflow on push or pull request
# events but only for the master branch
on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  build_and_run:
    runs-on: ubuntu-latest
    steps:
      - name: Run Commands via SSH
    # You may pin to the exact commit or the version.
    # uses: Flaavius/ssh-commands@79ae027ae651731b483988ee69b2f628c75422f1
        uses: Flaavius/ssh-commands@1.0
        with:
          # Command to run on the remote server
          command: |
            cd glory_dyeing/dyeing_backend
            git pull origin master
            sudo mvn clean install
            sudo fuser -k -n tcp 8080
            sudo java -jar ./target/gloryautofab-0.0.1-SNAPSHOT.jar > log.txt &
            
          # Hostname or IP address of the server.
          host: ec2-18-221-220-41.us-east-2.compute.amazonaws.com # optional, default is localhost
          # Username for authentication.
          username: ubuntu # optional
          # Port number of the server.
          port: 22 # optional, default is 22
          # File Location or string that contains a private key for either key-based or hostbased user authentication (OpenSSH format)
          privateKey: ${{ secrets.SSH_KEY }} # optional
